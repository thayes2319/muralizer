<html>
<head>
<meta charset="UTF-8">
<link rel="shortcut icon" href="favicon.ico">
<script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
<meta name="" />
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Scenique</title>

<link rel="manifest" href="muralizer-manifest-v2.json">
<meta name="theme-color" content="#111111">
<link rel="apple-touch-icon" href="icons/icon-512-scenique.png">

<!-- ‚≠ê PWA NAME OVERRIDES (add these) -->
<meta name="application-name" content="Sc√©nique">
<meta name="apple-mobile-web-app-title" content="Sc√©nique">

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="apple-touch-startup-image" href="splash/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px)">
<link rel="apple-touch-startup-image" href="splash/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px)">
<link rel="apple-touch-startup-image" href="splash/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px)">
<link rel="apple-touch-startup-image" href="splash/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px)">
<link rel="apple-touch-startup-image" href="splash/splash-828x1792.png" media="(device-width: 414px) and (device-height: 896px)">
<link rel="apple-touch-startup-image" href="splash/splash-1242x2688.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)">
<link rel="apple-touch-startup-image" href="splash/splash-1536x2048.png" media="(device-width: 768px) and (device-height: 1024px)">
<link rel="apple-touch-startup-image" href="splash/splash-1668x2388.png" media="(device-width: 834px) and (device-height: 1194px)">
<link rel="apple-touch-startup-image" href="splash/splash-2048x2732.png" media="(device-width: 1024px) and (device-height: 1366px)">

<style type="text/css">




/* PART 1 */

.style10 {
  font-size: 10pt;
  font-family: "Arial Narrow", serif;
}

.style11 {
  font-size: 11pt;
  font-family: "Calibri", serif;
}

.style12 {
  font-size: 12pt;
  font-family: "Arial Narrow", serif;
}

.style5 {
  color: #4D5B5E;
}

.style6 {
  font-size: 11pt;
  font-family: "Arial Narrow", serif;
}

.style7 {
  font-size: 18px;
}

.style8 {
  font-size: 9pt;
  font-family: "Arial Narrow", serif;
}


/* PART 1B */

p { outline-color: #393633; }

p.dotted { outline-style: dotted; }
p.dashed { outline-style: dashed; }
p.solid  { outline-style: solid; }
p.double { outline-style: double; }
p.groove { outline-style: groove; }
p.ridge  { outline-style: ridge; }
p.inset  { outline-style: inset; }
p.outset { outline-style: outset; }


.scroll-wrapper {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

.scroll-wrapper .simulator {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  border: none;
  transform: scale(1.5);
  transform-origin: 0 0;
}

html, body {
  margin: 0;
  padding: 0;
  min-width: 0; /* remove the desktop-only constraint */
}

.body-wrapper {
  width: auto;            /* allow horizontal expansion */
  min-height: auto;       /* allow vertical expansion */
  margin: 0 auto;
  padding: 8px 8px 0 8px; /* top | right | bottom | left */
  box-sizing: border-box;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 8px;
  backdrop-filter: blur(4px);
  display: block;
}





.heading {
  margin: 0;
  text-align: left;
  font-family: "Arial Narrow";
  font-size: 32px;
  color: #43403E;
  font-weight: 700;
  letter-spacing: 1pt;
}

.simulator {
  width: 100%;
  height: 825px;
  border: none;
  display: block;
}

body {
  font-family: Candara, sans-serif;
  margin: 20px 20px 20px 20px;
}

h2 {
  font-size: 28pt;
  margin-top: 0;
  margin-bottom: 2px;
  text-align: left;
  line-height: 1.1;
}

/* Give the Muralizer feature list breathing room */
.feature-list {
  margin-top: 20px;       /* space above */
  margin-bottom: 20px;    /* space below */
  padding: 0 20px;        /* left/right breathing room */
  text-align: center;
}

/* Center the text and give it internal padding */
.feature-list p {
  margin: 0 auto;
  padding: 10px 0;        /* vertical breathing room */
  text-align: center;     /* center the features */
  border-bottom: 2px solid #4D4D4D;
font-size: 26px;
font-weight: 700;
/*letter-spacing: 0.3px;*/
}


.feature-list .feature {
  font-family: Candara, "Segoe UI", sans-serif;
  color: #333;
  padding: 0 1px;
}

.feature-list .divider,
.feature-list span[style*="#218FC9"] {
  font-size: 28px; 
  font-weight: bold;
  color: #218FC9;
  font-weight: bold;
  padding: 0 1px;
}

.feature {
  display: inline-block;
  margin: 0;
}

@keyframes strobe {
  0%   { color: inherit; font-weight: normal; transform: scale(1); }
  50%  { color: #F04E1F; font-weight: bold; transform: scale(1.3); }
  100% { color: inherit; font-weight: normal; transform: scale(1); }
}

.strobe {
  display: inline-block;
  animation: strobe 2.5s ease-in-out;
  animation-iteration-count: 2;
  transform-origin: center;
  will-change: transform, color;
  background-color: white;
  padding: 1px 1px;
  border-radius: 4px;
}

/* PART 2 */

.signin-strobe {
  margin: 30px 0;
  font-family: Candara, sans-serif;
  font-size: 24pt;
  animation: strobeLine 7.5s ease-in-out infinite;
}

.signin-highlight {
  color: #F04E1F;
}

.signin-password {
  color: #218FC9;
  cursor: help;
  font-weight: bold;
}

@keyframes strobeLine {
  0%   { opacity: 1; transform: scale(1); }
  10%  { opacity: 0.75; transform: scale(1.1); }
  20%  { opacity: 1; transform: scale(1); }
  30%  { opacity: 0.75; transform: scale(1.1); }
  40%  { opacity: 1; transform: scale(1); }
  50%  { opacity: 0.75; transform: scale(1.1); }
  60%  { opacity: 1; transform: scale(1); }
  100% { opacity: 1; transform: scale(1); }
}


.descriptor-layout {
  display: flex;
  flex-direction: column;
  gap: 32px;
  margin-top: 30px;
}




.selector-group {
  margin-bottom: 15px;
  margin-left: auto; 
margin-right: auto; 
display: block;
}

.selector-group label {
  display: block;
  margin-bottom: 5px;
  font-size: 1.3rem;
  font-weight: 600;
  color: #2a6f97;
  letter-spacing: 0.2px;
}

.tag {
  display: inline-block;
  background: #e8f3ff;
  color: #005a9e;
  padding: 4px 8px;
  margin: 3px;
  border-radius: 4px;
  font-size: 12px;
}

.saved-scenes-list {
  margin-top: 10px;
}

.saved-scenes-list button {
  display: block;
  width: 100%;
  margin-bottom: 6px;
  padding: 8px;
  text-align: left;
  border-radius: 4px;
  background: #eef6ff;
  border: 1px solid #c7ddf5;
  cursor: pointer;
  font-family: Candara, sans-serif;
}

.saved-scenes-list button:hover {
  background: #dcecff;
}

.save-panel-inner {
  background: #f4f8ff;
  border: 1px solid #c7ddf5;
  border-radius: 6px;
  padding: 10px;
  font-family: Candara, sans-serif;
}

.save-panel-label {
  margin-bottom: 6px;
  color: #218FC9;
  font-weight: bold;
}

#saveNameInput {
  width: 100%;
  padding: 6px 8px;
  margin-bottom: 8px;
  border-radius: 4px;
  border: 1px solid #c0c0c0;
  font-family: Candara, sans-serif;
}

.save-panel-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

.save-panel-actions button {
  padding: 6px 10px;
  border-radius: 4px;
  border: 1px solid #c0c0c0;
  cursor: pointer;
}

#elementsSelect option[disabled],
#elementsSelect option.group-title {
  font-family: Candara, sans-serif;
  color: #218FC9;
  font-weight: bold;
}

#elementsSelect option.group-title {
  padding-top: 6px;
  padding-bottom: 3px;
  background: #f4f8ff;
  border-top: 1px solid #d0e7f7;
}

#elementsSelect {
  display: block !important;
  height: auto !important;
  min-height: 40px !important;
  visibility: visible !important;
  opacity: 1 !important;
}


.feel-button-row {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 6px;
  width: 100%;
  margin-bottom: 10px;
}

.feel-btn {
  padding: 4px 10px;
  border-radius: 14px;
  border: 1px solid #218FC9;
  background: #f4f8ff;
  color: #218FC9;
  font-family: Candara, sans-serif;
  cursor: pointer;
  transition: background 0.15s ease;
  flex: 0 1 auto;
  white-space: nowrap;
}

.feel-btn.active {
  background-color: #218FC9 !important;
  color: white !important;
  border-color: #218FC9 !important;
}



.json-output,
.description-output {
  width: 85%;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
  font-family: Consolas, monospace;
  font-size: 0.9rem;
  background: #fafafa;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 8px;
  line-height: 1.3;
  white-space: pre-wrap;
}

.json-output {
  max-height: 50px;
  overflow-y: auto;
}

.description-output {
  max-width: 900px;
  font-size: 14px;
  padding-top: 0.5rem !important;
  padding-bottom: 1rem !important;
  border: 1px solid #ccc;
  border-radius: 6px;
}

.descriptor-selectors {
  flex: 1.2;
}

.descriptor-header {
  margin-bottom: 10px;
}

.descriptor-header h1 {
  margin-top: 40px;
  margin-bottom: 10px;
  font-family: Candara, sans-serif;
  font-size: 2rem;
  font-weight: 600;
  color: #1f3b4d;
  letter-spacing: 0.3px;
  text-align: center;
}

.descriptor-header p {
  font-size: 1.65rem;
  font-weight: 600;
  color: #1f3b4d;
  text-align: center;
  margin-top: 0.5rem;
  letter-spacing: 0.3px;
color: #333; /* darker for contrast */
  font-family: Candara, sans-serif;
}

.hidden {
  display: none !important;
}

.hue-pair {
  justify-content: center;
  display: flex;
  gap: 20px;
  align-items: flex-start;
}

.hue-picker {
  align-items: center;
  display: flex;
  flex-direction: column;
}

.hue-swatch {
  width: 100%;
  height: 80px;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-top: 12px;
  margin-bottom: 8px;
  box-sizing: border-box;
  box-shadow: 0 1px 3px rgba(0,0,0,0.15);
}

.spinner {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: 6px solid transparent;
  border-top-color: #ff6b6b;
  border-right-color: #feca57;
  border-bottom-color: #1dd1a1;
  border-left-color: #54a0ff;
  animation: spin 1s linear infinite;
  margin-top: 16px;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}

.generate-row {
  display: flex;
  flex-wrap: wrap; /* ‚Üê THIS is the missing piece */
  justify-content: center;
  align-items: center;
  gap: 5px;
  margin-top: -0.25rem;
  margin-bottom: 0.25rem;
}

.aspect-select {
  flex: 1 1 200px; /* grows, shrinks, wraps cleanly */
  padding: 6px 10px;
  font-size: 15px;
  border-radius: 6px;
  border: 1px solid #bbb;
  background: #f5f5f5;
  min-width: 160px;
  max-width: 200px;
}

/* PART 3 */

#generateMuralBtn {
  line-height: 1; /* ‚Üê makes padding matter again */
  padding: 10px 14px;              /* taller + wider */
font-family: "Lucida Handwriting", "Segoe UI", cursive;  
font-size: 18px;                 /* bigger text */
  font-weight: 700;                /* stronger presence */
  letter-spacing: 1px;           /* stretch the text horizontally */
  white-space: nowrap;             /* NEVER wrap to two lines */
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.1s ease;
}

#generateMuralBtn:hover {
  background-color: #218FC9;
}

#generateMuralBtn:active {
  transform: scale(1.05);          /* subtle, not huge */
}

#spinner {
  margin-top: -0.25rem;
  margin-bottom: 1rem;
}


.right-column .mzr-panel {
  margin-bottom: 0rem;
}

.save-panel {
  overflow: hidden;
  transition: max-height 0.25s ease, opacity 0.25s ease, margin 0.25s ease;
}

.save-panel.collapsed {
  max-height: 0;
  opacity: 0;
  margin: 0;
  padding: 0;
  pointer-events: none;
}

.save-panel.expanded {
  max-height: 200px;
  opacity: 1;
  margin-top: 10px;
  padding: 10px 0;
  pointer-events: auto;
}

.mzr-panel {
  position: relative;
  border: 1px solid #ccc;
  border-radius: 14px;
  padding: 1rem 1rem 1.5rem;
  margin: 0.25rem 1rem; /* top/bottom = .5rem, left/right = .5rem */
  background: #fff;
  min-width: 0;
}

.mzr-panel-body {
  background: transparent;
  padding: 0;
  margin: 0;
  border: none;
}

.mural-scenes .mzr-panel-body {
  padding-top: 1.25rem;
}

.textarea-wrapper {
  overflow: hidden;
  background: #fff;
  padding-bottom: 0.5rem;
}

/* -----------------------------------------------------------
   GLOBAL RESET FOR PROMPT + OUTPUT
----------------------------------------------------------- */
.prompt-box,
.description-output {
  border: none;
  outline: none;
  box-shadow: none;
  background: transparent;
  padding-top: 0.5rem;
  padding-bottom: 1rem;
  margin: 0;
}

/* -----------------------------------------------------------
   IMAGE + WATERMARK
----------------------------------------------------------- */
#muralImage {
  display: block;
  max-width: 100%;
  margin: 0.5rem auto .25rem;
}

.mural-wrapper {
  position: relative;
  display: block;
  padding: 0 20px;
  margin-bottom: 0;
}

.mural-watermark {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) rotate(-15deg) scale(0.8);
  font-size: 12vw;
  font-weight: 700;
  color: rgba(255, 255, 255, 0.20);
  white-space: nowrap;
  pointer-events: none;
  user-select: none;
  display: none;
}

#imageWrapper.has-image .mural-watermark {
  display: block;
}

/* -----------------------------------------------------------
   OUTPUT GRID
----------------------------------------------------------- */
.mural-output-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 24px;
  margin-top: 24px;
}

.mural-description {
  display: none !important;
}


/* -----------------------------------------------------------
   HEADER ‚Äî SC√âNIQUE VERSION
----------------------------------------------------------- */

/* Brand title */
.scenique-title {
  font-family: Candara, sans-serif;
  font-size: 50px;
  font-weight: 300;          /* lighter, more premium */
  color: #433D39;
  margin: 0;
  padding: 0;
  letter-spacing: 0.9px;
  line-height: 1.05;         /* tighter vertical rhythm */
  white-space: nowrap;
  position: relative;        /* allows subtitle to align under it */
}

/* Brand Subtitle ‚Äî stacked but right-biased */
.scenique-subtitle {
  font-family: Candara, sans-serif;
  font-size: 20px;           /* smaller than Sc√©nique */
  font-weight: 400;          /* light, elegant */
  color: #433D39;
  margin: 0;
  padding: 0;
  letter-spacing: 2px;       /* airy, refined */
  text-transform: lowercase; /* optional: studio vibe */
  white-space: nowrap;
  opacity: 0.85;
  
  /* ‚≠ê The magic: bias subtitle to the right side of Sc√©nique */
  display: block;
  text-align: right;         /* aligns subtitle to the right edge of Sc√©nique */
  width: 100%;               /* ensures alignment uses Sc√©nique width */
  
  margin-top: -4px;          /* subtle tuck upward */
}


/* Phone number (now top-left) */
.header-phone {
  font-family: Candara, sans-serif;
  font-size: 16px;
  font-weight: 500;
  color: #433D39;
  white-space: nowrap;
  margin-bottom: 10px;
}

/* Header container */
.header-bar {
  width: 100%;
  padding-top: 2px !important; /* was 10px */ 
  padding-bottom: 4px !important;
  margin: 0;
  box-sizing: border-box;
  display: flex;
  justify-content: space-between;
  align-items: center;   /* center vertically */
}

/* LEFT: phone + Sc√©nique stacked */
.header-left {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

/* RIGHT: small logo */
.header-right {
  display: flex;
  align-items: center;
  justify-content: center;
}

.header-right img.header-logo {
  height: 44px;          /* small fraction of old size */
  width: auto;
  object-fit: contain;
}


.nav-color-row {
   width: 100%;
  display: flex;
  margin-top: 0px;
  margin-bottom: -5px;
}



/* -----------------------------------------------------------
   FEEL BUTTONS
----------------------------------------------------------- */
.feel-btn.selected {
  background-color: #333;
  color: white;
  border-color: #333;
}

/* -----------------------------------------------------------
   SAVED ROWS
----------------------------------------------------------- */
.saved-row {
  display: flex !important;
  flex-direction: row !important;
  justify-content: space-between !important;
  align-items: center !important;
  width: 100% !important;
  gap: 8px;
  margin-bottom: 6px;
}

.saved-row .load-btn {
  flex: 1 1 auto !important;
  width: auto !important;
  display: inline-block !important;
}

.saved-row .delete-btn {
  flex: 0 0 auto !important;
  min-width: 40px !important;
  height: 30px !important;
  padding: 4px 8px !important;
  background: #c62828 !important;
  color: white !important;
  border: none !important;
  border-radius: 4px !important;
  cursor: pointer !important;
}

.load-btn {
  flex: 1;
  text-align: left;
  padding: 6px 8px;
}

.delete-btn {
  background: rgba(0,0,255,0.5) !important;
  border: 2px solid blue !important;
  min-width: 40px !important;
  height: 30px !important;
  display: inline-block !important;
}

.saved-row button {
  display: inline-flex !important;
  width: auto !important;
  margin-bottom: 0 !important;
  padding: 6px 8px !important;
}

/* -----------------------------------------------------------
   SCENE BUTTONS
----------------------------------------------------------- */
.scene-actions {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 10px;
}

.scene-btn.small {
  padding: 4px 10px;
  font-size: 12px;
  border-radius: 6px;
  border: 1px solid #bbb;
  background: #f5f5f5;
  cursor: pointer;
}

.scene-btn.small.danger {
  border-color: #c62828;
  color: #c62828;
  background: #fff;
}

.scene-btn.small.danger:hover {
  background: #ffe5e5;
}

.scene-item:hover {
  background: #e8f3ff;
}

.scene-item.selected {
  background: #c7ddf5;
  border-color: #218FC9;
  font-weight: bold;
}

/* -----------------------------------------------------------
   IMAGE WRAPPER
----------------------------------------------------------- */
#imageWrapper {
  margin: 0px 0;
  padding-right: 16px;
  display: inline-block;
  position: relative;
}

/* -----------------------------------------------------------
   PANELS
----------------------------------------------------------- */
.mzr-panel {
  position: relative;
  border: 1px solid #ccc;
  border-radius: 14px;
  padding: 1rem 1rem 1.5rem;
  margin: 0.25rem auto;
  background: #fff;
  width: 100%;
  max-width: 900px;
  box-sizing: border-box;
}

.mzr-panel-body {
  background: transparent;
  padding: 0;
  margin: 0;
  border: none;
}

.mural-scenes .mzr-panel-body {
  padding-top: 1.25rem;
}

.textarea-wrapper {
  overflow: hidden;
  background: #fff;
  padding-bottom: 0.5rem;
}

.prompt-box {
  resize: none;
  overflow: hidden;
  min-height: 40px;
}

.mzr-panel-title {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translate(-50%, -50%);
  margin: 0;
  padding: 0.25rem 0.75rem;
  background: #fff;
  font-size: 0.95rem;
  font-weight: 600;
  letter-spacing: 0.03em;
  color: #333;
  border-radius: 999px;
}

/* -----------------------------------------------------------
   TONE LABELS ‚Äî FINAL, CLEAN, MATCHES PANEL TITLE PILLS
----------------------------------------------------------- */

/* The pill wrapper (matches .mzr-panel-title styling) */
.tone-toggle-wrapper {
  position: absolute;
  bottom: -0.75rem;
  left: 50%;
  transform: translateX(-50%);
  background: #fff;
  padding: 0.25rem 0.75rem;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  font-size: 0.95rem;
  font-weight: 600;
  letter-spacing: 0.03em;
  color: #333;
}

/* Inner layout for the two tone options */
.tone-bottom-label {
  display: flex;
  gap: 20px;
  align-items: center;
  font-family: Candara, sans-serif;
}

/* Radio + text alignment */
.tone-option {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  cursor: pointer;
  font-size: 14pt;
}

/* Radio scaling */
.tone-option input[type="radio"] {
  transform: scale(1.4);
}

/* Make Technical + Poetic text brand blue */
.tone-bottom-label label {
  color: #218FC9;
}



/* -----------------------------------------------------------
   SINGLE-COLUMN DEFAULT LAYOUT (DESKTOP + MOBILE)
----------------------------------------------------------- */
.descriptor-layout {
  display: flex;
  flex-direction: column;
  gap: 32px;
  margin-top: 30px;
}

.left-column,
.right-column {
  width: 100%;
  max-width: 900px;
  margin: 0 auto;
  padding: 0 20px;
  box-sizing: border-box;
}

/* -----------------------------------------------------------
   GENERATE ROW
----------------------------------------------------------- */
.generate-row {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 5px;
  margin-top: 20px;
  margin-bottom: 0.25rem;
}

.aspect-select {
  flex: 1 1 200px;
  padding: 6px 10px;
  font-size: 15px;
  border-radius: 6px;
  border: 1px solid #bbb;
  background: #f5f5f5;
  min-width: 160px;
  max-width: 200px;
}

/* -----------------------------------------------------------
   GENERATE BUTTON
----------------------------------------------------------- */
#generateMuralBtn {
  line-height: 1;
  padding: 10px 14px;
  font-family: "Lucida Handwriting", "Segoe UI", cursive;
  font-size: 18px;
  font-weight: 700;
  letter-spacing: 1px;
  white-space: nowrap;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.1s ease;
}

#generateMuralBtn:hover {
  background-color: #218FC9;
}

#generateMuralBtn:active {
  transform: scale(1.05);
}

#spinner {
  margin-top: -0.25rem;
  margin-bottom: 1rem;
}

/* -----------------------------------------------------------
   NEXT STEPS
----------------------------------------------------------- */

.save-instruction, 
.next-steps, 
.pro-access {
  text-align: center; 
}

.save-instruction {
  margin-top: 20;
  margin-bottom: 5px;
  font-size: 16px;
  color: #666;
  font-style: italic;
}

.next-steps {
  padding: 0 18px;
  margin-top: .25rem;
  margin-bottom: .5rem;
  font-size: 1.2rem;
  color: black;
  font-style: italic;
  text-align: center;
}

.next-steps strong {
  display: inline-block;
  margin-bottom: 8px;
}

.next-steps .step {
  display: block;
  text-align: center;
  white-space: nowrap;
  font-weight: 800;
  text-shadow:
    0 0 .5px rgba(0,0,0,0.25),
    0 0 .5px rgba(0,0,0,0.25);
}

.next-steps .step:nth-of-type(1) { color: #2196F3; }
.next-steps .step:nth-of-type(2) { color: #B38A1E; }
.next-steps .step:nth-of-type(3) { color: #4F5B6B; }
.next-steps .step:nth-of-type(4) { color: #4CAF50; }

.pro-access { 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  gap: 8px;
margin-bottom: 16px !important; /* increase or decrease as needed */ 
}


.spinner-wrapper,
.spinner,
.loading-spinner {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto;
  text-align: center;
}



/* -----------------------------------------------------------
   SAVE PANEL
----------------------------------------------------------- */

.save-panel {
  overflow: hidden;
  transition: max-height 0.25s ease, opacity 0.25s ease, margin 0.25s ease;
}

.save-panel.collapsed {
  max-height: 0;
  opacity: 0;
  margin: 0;
  padding: 0;
  pointer-events: none;
}

.save-panel.expanded {
  max-height: 200px;
  opacity: 1;
  margin-top: 10px;
  padding: 10px 0;
  pointer-events: auto;
}



.left-column .mzr-panel-body {
  text-align: center;
}

.left-column .selector-group {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.left-column select {
  width: 100%;
  max-width: 320px;
  margin: 0 auto;
}

.left-column .selector-group:first-of-type {
  margin-top: 20px;
}


/* COLLAPSED TAGS & KEYWORDS */

.mural-tags.collapsed .mzr-panel-body {
  display: none !important;
}

/* Expanded state shows the body */
.mural-tags.expanded .mzr-panel-body {
  display: block !important;
}

/* Optional: cursor change for affordance */
.mural-tags .mzr-panel-title {
  cursor: pointer;
}

.mural-tags .mzr-panel-title::after {
   content: "üîº";
  position: absolute;
  right: -20px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 20px;
  transition: transform 0.2s ease;
}

.mural-tags.collapsed .mzr-panel-title::after {
  content: "üîΩ";
}


/* COLLAPSED SAVE SCENE */


/* Collapse behavior */
.mural-scenes.collapsed .mzr-panel-body {
  display: none !important;
}

.mural-scenes.expanded .mzr-panel-body {
  display: block !important;
}

/* Chevron only ‚Äî no layout overrides */
.mural-scenes .mzr-panel-title::after {
  content: "üîº";
  position: absolute;
  right: -20px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 20px;
  transition: transform 0.2s ease;
}

.mural-scenes.collapsed .mzr-panel-title::after {
  content: "üîΩ";
}

/* Desktop: restore natural width for Scene Elements dropdown */
#elementsSelect {
  max-width: none;
  width: auto;
}



/* ============================================================
     MOBILE RENDER CHANGES
     ============================================================ */

@media (max-width: 600px) {

  /* All dropdowns */
  .selector-group select {
    width: 60%;
    max-width: 300px;
    font-size: 14px;
  }

  #elementsSelect { 
    width: 80%; 
    max-width: 300px; 
    font-size: 14px; 
  }

  /* Nav bars: duplicate desktop (flush left/right) */
  .nav-color-row {
    margin-top: 2px !important;
    padding: 0 !important;
  }

  /* Header mobile refinements */
  .header-bar { 
    padding-top: 2px !important; 
    padding-bottom: 2px !important; 
  } 

  .header-phone { 
    font-size: 16px; 
    margin-bottom: 1px; 
  } 

  .scenique-title { 
    font-size: 32px; 
    letter-spacing: 0.6px; 
  } 

  .header-right img.header-logo { 
    height: 32px; 
  }

  /* ============================================================
     MOBILE PANEL EXPANSION ‚Äî LEFT + RIGHT COLUMNS
     ============================================================ */

  .main-content,
  .content-wrapper,
  .columns,
  .mzr-columns {
    display: block !important;
    width: 100% !important;
  }

  .left-column {
    width: 100% !important;
    max-width: 100% !important;
    padding-left: 12px !important;
    padding-right: 12px !important;
    box-sizing: border-box !important;
  }

  .right-column {
    width: 100% !important;
    max-width: 100% !important;
    padding-left: 12px !important;
    padding-right: 12px !important;
    box-sizing: border-box !important;
  }

  .mzr-panel,
  .mzr-panel-body,
  .attribute-panel,
  .attribute-section,
  .textarea-wrapper,
  .description-wrapper,
  .scenes-wrapper,
  .keywords-wrapper,
  .image-gen-wrapper {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }

  .mzr-panel {
    margin-bottom: 12px !important;
  }

  .mural-wrapper {
    padding-left: 10px !important;
    padding-right: 10px !important;
  }

  #muralImage {
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    height: auto !important;
  }

  .attribute-section,
  .mzr-panel-body,
  .scenes-wrapper {
    height: auto !important;
    min-height: auto !important;
    overflow: visible !important;
  }
} /* ‚Üê THIS WAS THE MISSING BRACE */


/* ============================================================
     SMALL PHONE (<= 400px)
     ============================================================ */

@media (max-width: 400px) {
  .next-steps {
    font-size: 16px;
    margin-top: 12px;
    margin-bottom: 12px;
  }

  .next-steps .step {
    font-size: 15px;
    line-height: 1.35;
    margin-bottom: 6px;
    text-align: left;
  }
}


/* ============================================================
     DESKTOP TIGHTENING
     ============================================================ */

@media (min-width: 769px) {
  .mural-wrapper {
    padding-left: 0px !important;
    padding-right: 0px !important;
  }
}

</style>


<base target="_self">

</head>

<body 
  vlink="#E67F33" 
  link="#E67F33" 
  alink="#0070C0" 
  bgcolor="#333232" 
  background="https://www.gohw.net/muralizer/leafy green botanical.png"
>

<!-- ‚≠ê BODY WRAPPER STARTS HERE -->
<div class="body-wrapper">

  <!-- ‚≠ê MODERN HEADER -->
<div class="header-bar">

<div class="header-left">
  <div class="header-phone">770-508-9596</div>
  <h1 class="scenique-title">Sc√©nique</h1>
  <h1 class="scenique-subtitle">....murals</h1>
</div>




  <!-- RIGHT: SMALL LOGO -->
  <div class="header-right">
    <a href="index.html">
      <img src="http://www.GOHW.net/images/HwRenewal-2017-350w.png" class="header-logo">
    </a>
  </div>

</div>
<!-- ‚≠ê END MODERN HEADER -->



  <!-- ‚≠ê NAV COLOR BAR -->
  <div class="nav-color-row">
    <div style="flex:1; height:12px; background:#F4C649;"></div>
    <div style="width:6px;"></div>

    <div style="flex:1; height:12px; background:#218FC9;"></div>
    <div style="width:6px;"></div>

    <div style="flex:1; height:12px; background:#3B9F3E;"></div>
    <div style="width:6px;"></div>

    <div style="flex:1; height:12px; background:#FFFFFF;"></div>
  </div>
 <!-- ‚≠ê END NAV COLOR BAR -->


<!-- ‚≠ê SINGLE-COLUMN LAYOUT -->
<div class="descriptor-layout">

  <!-- LEFT COLUMN -->
  <div class="left-column">

    <div class="mzr-panel left-column">
      <h2 class="mzr-panel-title">Attributes</h2>

      <div class="mzr-panel-body">

        <!-- Feel -->
        <div class="selector-group">
          <label>Feel</label>
          <div id="feelButtons" class="feel-button-row">
            <button type="button" class="feel-btn" data-feel="soft">soft</button>
            <button type="button" class="feel-btn" data-feel="crisp">crisp</button>
            <button type="button" class="feel-btn" data-feel="vintage">vintage</button>
            <button type="button" class="feel-btn" data-feel="modern">modern</button>
            <button type="button" class="feel-btn" data-feel="quiet">quiet</button>
            <button type="button" class="feel-btn" data-feel="dramatic">dramatic</button>
            <button type="button" class="feel-btn" data-feel="rough">rough</button>
            <button type="button" class="feel-btn" data-feel="smooth">smooth</button>
            <button type="button" class="feel-btn" data-feel="American">American</button>
            <button type="button" class="feel-btn" data-feel="East Asian">East Asian</button>
          </div>
        </div>

        <!-- Lock Style Mode -->
        <div class="selector-group">
          <label class="lock-style">
            <input type="checkbox" id="lockStyleToggle">
            Lock Style Mode
          </label>
        </div>

        <!-- Category -->
        <div class="selector-group">
          <label>Category</label>
          <select id="categorySelect"></select>
        </div>

        <!-- Sub-Scene -->
        <div class="selector-group">
          <label>Sub-Scene</label>
          <select id="subSceneSelect"></select>
        </div>

        <!-- Scene Elements -->
        <div class="selector-group">
          <label>Scene Elements</label>
          <select id="elementsSelect" multiple size="8"></select>
        </div>

        <!-- Application Style -->
        <div class="selector-group">
          <label>Application Style</label>
          <select id="applicationSelect"></select>
        </div>

        <!-- Color Mode -->
        <div class="selector-group">
          <label>Color Mode</label>
          <select id="colorMode">
            <option value="Bright Multi-Color">Bright Multi-Color</option>
            <option value="2-Color">2-Color</option>
            <option value="Monotone">Monotone</option>
            <option value="Sepia Only">Sepia Only</option>
            <option value="Vintage Washed">Vintage Washed</option>
          </select>
        </div>

        <!-- Color Controls -->
        <div class="selector-group">
          <label>Color Controls</label>

          <div class="toggle-row" style="display:flex; gap:20px; margin-top:6px;">
            <label style="display:flex; align-items:center; gap:6px;">
              <input type="checkbox" id="colorLockToggle">
              Color Lock
            </label>

            <label id="gradientToggleWrapper" style="display:flex; align-items:center; gap:6px;">
              <input type="checkbox" id="gradientToggle">
              Gradient Mode
            </label>
          </div>
        </div>

        <div class="hue-pair">

          <div id="primaryHueContainer" class="hue-picker hidden">
            <label>Primary</label>
            <div id="primaryHueWheel"></div>
            <input type="hidden" id="primaryHue">
            <div id="primarySwatch" class="hue-swatch"></div>
          </div>

          <div id="secondaryHueContainer" class="hue-picker hidden">
            <label>Secondary</label>
            <div id="secondaryHueWheel"></div>
            <input type="hidden" id="secondaryHue">
            <div id="secondarySwatch" class="hue-swatch"></div>
          </div>

        </div>

        <!-- Fog Mode -->
        <div class="selector-group">
          <label>Fog Mode</label>
          <select id="fogModeSelect"></select>
        </div>

        <!-- Substrate -->
        <div class="selector-group">
          <label>Substrate Texture</label>
          <select id="substrateTextureSelect"></select>
        </div>

        <!-- Panel Type -->
        <div class="selector-group">
          <label>Panel Type</label>
          <select id="panelTypeSelect"></select>
        </div>

      </div>
    </div>

  </div> <!-- END left-column -->


  <!-- RIGHT COLUMN -->
  <div class="right-column">

  <div class="mzr-panel">
  <h2 class="mzr-panel-title">Mural Description</h2>

  <div class="mzr-panel-body">
    <div class="textarea-wrapper">
      <textarea id="imagePrompt" class="description-output prompt-box"></textarea>
    </div>
  </div>

  <!-- ‚≠ê Tone pill belongs INSIDE the panel -->
  <div class="tone-toggle-wrapper">
    <div class="tone-bottom-label">
      <label class="tone-option">
        <input type="radio" name="tone" value="technical" checked> Technical
      </label>

      <label class="tone-option">
        <input type="radio" name="tone" value="poetic"> Poetic
      </label>
    </div>
  </div>

</div> <!-- closes the Mural Description panel -->



    <div class="generate-row">
      <select id="aspectRatioSelect" class="aspect-select">
        <option value="1:1">Square (1:1)</option>
        <option value="4:5">Portrait - Tall (4:5)</option>
        <option value="2:3">Portrait - Taller (2:3)</option>
        <option value="5:4">Landscape - Short (5:4)</option>
        <option value="3:2">Landscape - Standard (3:2)</option>
        <option value="16:9">Widescreen (16:9)</option>
        <option value="21:9" selected>Ultra-Wide (21:9)</option>
      </select>

      <button id="generateMuralBtn" onclick="generateImage()">Generate Your Mural</button>
    </div>

    <p id="saveInstruction" class="save-instruction">
      Right click the image once appears, and Save-As
    </p>

    <div id="spinner" class="spinner hidden"></div>

    <div class="pro-access">
      <input type="password" id="proPassword" placeholder="Password only for Saves">
      <button id="proUnlockBtn">Unlock</button>
    </div>

    <div id="imageWrapper" class="mural-wrapper">
      <img id="muralImage">
      <div class="mural-watermark">HW Renewal</div>
    </div>

    <p class="next-steps">
      <strong>What We Do Next:</strong><br>
      <span class="step">1. Capture your space boundaries</span>
      <span class="step">2. Customize the mural for your space</span>
      <span class="step">3. Divide Panels & make print-ready</span>
      <span class="step">4. Print & Install</span>
    </p>

    <div class="mural-output-grid">

      <section class="mzr-panel mural-description">
        <h2 class="mzr-panel-title">Mural Description</h2>
        <div class="mzr-panel-body">
          <pre id="descriptionOutput" class="description-output"></pre>
          <button id="copyDescriptionBtn">Copy Description</button>
        </div>
      </section>

     <section class="mzr-panel mural-scenes collapsed">
        <h2 class="mzr-panel-title">Scenes</h2>
        <div class="mzr-panel-body">

          <div class="scene-actions">
            <button id="saveSceneBtn">Save Current Scene</button>
            <button id="deleteSceneBtn">Delete Selected Scene</button>
          </div>

          <div id="savePanel" class="save-panel collapsed">
            <div class="save-panel-inner">
              <div class="save-panel-label">Suggested name:</div>
              <input type="text" id="saveNameInput">
              <div class="save-panel-actions">
                <button id="cancelSaveBtn" type="button">Cancel</button>
                <button id="confirmSaveBtn" type="button">Confirm Save</button>
              </div>
            </div>
          </div>

          <div id="savedScenesList" class="saved-scenes-list"></div>

        </div>
      </section>

<section class="mzr-panel mural-tags collapsed">
  <h2 class="mzr-panel-title" title="Click to expand or collapse">
  Tags & Keywords
</h2>
  <div class="mzr-panel-body">
    <div id="tagPreview" class="tag-preview"></div>
    <pre id="jsonOutput" class="json-output"></pre>
  </div>
</section>

    </div> <!-- end mural-output-grid -->

  </div> <!-- end right-column -->

</div> <!-- end descriptor-layout -->


</body>







<script>

/* Tags & Keywords panel ‚Äî accordion toggle */

const tagsPanelTitle = document.querySelector('.mural-tags .mzr-panel-title');

if (tagsPanelTitle) {
  tagsPanelTitle.addEventListener('click', function () {
    const panel = this.closest('.mural-tags');
    panel.classList.toggle('collapsed');
    panel.classList.toggle('expanded');
  });
}

/* Scenes panel ‚Äî accordion toggle */

const scenesPanelTitle = document.querySelector('.mural-scenes .mzr-panel-title');

if (scenesPanelTitle) {
  scenesPanelTitle.addEventListener('click', function () {
    const panel = this.closest('.mural-scenes');
    panel.classList.toggle('collapsed');
    panel.classList.toggle('expanded');
  });
}





/* ============================================================
   PART A ‚Äî TOP‚ÄëLEVEL HELPERS + COLOR + DESCRIPTION
   ============================================================ */

function autoExpand(el) {
  el.style.height = "auto";
  el.style.height = el.scrollHeight + "px";
}

async function generateImage() {
  const spinner = document.getElementById("spinner");
  const aspectRatio = document.getElementById("aspectRatioSelect").value;
  spinner.classList.remove("hidden");

  const prompt = document.getElementById("imagePrompt").value;

  try {
    const response = await fetch("https://muralizer.onrender.com/generate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        prompt,
        aspect_ratio: aspectRatio,
        width: 2048,
        height: 512
      })
    });

    const data = await response.json();
    const imgBase64 = data.image || (data.artifacts && data.artifacts[0].base64);

    document.getElementById("muralImage").src =
      `data:image/png;base64,${imgBase64}`;
  } catch (err) {
    console.error("Generation error:", err);
  } finally {
    spinner.classList.add("hidden");
  }
}

let selectedFeel = null;
let userTouchedStyle = false;
let lockedStyle = null;

/* -----------------------------
   COLOR MATH HELPERS
   ----------------------------- */

function hexToHsl(hex) {
  let r = parseInt(hex.substr(1,2),16)/255;
  let g = parseInt(hex.substr(3,2),16)/255;
  let b = parseInt(hex.substr(5,2),16)/255;
  const max = Math.max(r,g,b), min = Math.min(r,g,b);
  let h, s, l = (max+min)/2;
  if (max === min) {
    h = s = 0;
  } else {
    const d = max-min;
    s = l > 0.5 ? d/(2-max-min) : d/(max+min);
    switch(max){
      case r: h = (g-b)/d + (g<b ? 6 : 0); break;
      case g: h = (b-r)/d + 2; break;
      case b: h = (r-g)/d + 4; break;
    }
    h /= 6;
  }
  return { h: h*360, s: s*100, l: l*100 };
}

function hslToHex(h,s,l){
  s /= 100; l /= 100;
  const k = n => (n + h/30) % 12;
  const a = s * Math.min(l, 1-l);
  const f = n => l - a * Math.max(-1, Math.min(k(n)-3, Math.min(9-k(n),1)));
  return "#" + [f(0),f(8),f(4)]
    .map(x => Math.round(x*255).toString(16).padStart(2,"0"))
    .join("");
}

function analogousColor(hex){
  const {h,s,l} = hexToHsl(hex);
  return hslToHex((h+37)%360, s, l);
}

/* -----------------------------
   SWATCH HELPERS
   ----------------------------- */

function updatePrimarySwatch(color) {
  const swatch = document.getElementById("primarySwatch");
  if (swatch && color) swatch.style.backgroundColor = color.hexString || color;
}

function updateSecondarySwatch(color) {
  const swatch = document.getElementById("secondarySwatch");
  if (swatch && color) swatch.style.backgroundColor = color.hexString || color;
}

/* -----------------------------
   FEEL + DESCRIPTION ENGINE
   ----------------------------- */

const feelAdj = {
  soft: "soft and atmospheric",
  crisp: "crisp and clean",
  vintage: "vintage and nostalgic",
  modern: "modern and refined",
  quiet: "quiet and understated",
  dramatic: "dramatic and bold",
  rough: "rough and textured",
  smooth: "smooth and flowing",
  American: "American‚Äëinspired",
  "East Asian": "East Asian‚Äëinspired"
};


function getSelectedTone(){
  return document.querySelector("input[name='tone']:checked")?.value || "poetic";
}

function describeHuePoetic(hex) {
  const { h } = hexToHsl(hex);
  const pick = arr => arr[Math.floor((h % 360) / (360 / arr.length)) % arr.length];

  if (h >= 350 || h < 20) return pick(["deep vermilion","ember-red","crimson warmth","sun-kissed scarlet","burnished red-ochre","soft rose-ember"]);
  if (h < 45) return pick(["sun-touched orange","warm apricot glow","soft tangerine haze","amber-washed light","golden-peach warmth"]);
  if (h < 70) return pick(["golden light","honey-amber","soft marigold","pale wheat-gold","sunlit straw"]);
  if (h < 160) return pick(["fresh spring-green","bright chartreuse","soft meadow-green","deep forest-green","cool jade-green","moss-washed green","emerald-shadowed green"]);
  if (h < 200) return pick(["sea-glass teal","misty aqua","cool lagoon-teal","soft ocean-green","deep tide-teal"]);
  if (h < 250) return pick(["calm sky-blue","soft horizon-blue","deep lake-blue","cool sapphire-blue","mist-washed blue"]);
  if (h < 290) return pick(["twilight indigo","deep dusk-indigo","soft midnight-blue","storm-washed indigo","ink-shadowed blue"]);
  if (h < 330) return pick(["dusk-violet","soft lavender-shadow","deep amethyst tone","cool orchid-violet","twilight plum"]);
  if (h < 350) return pick(["soft berry-rose","deep wine-magenta","orchid-rose glow","violet-crimson blend","plum-washed magenta"]);

  return "a nuanced tone";
}

function describeHueTechnical(hex){
  return hex.toUpperCase();
}


function isVintageWashedMode(mode) {
  return mode === "Vintage Washed";
}

function isTwoColorMode(mode) {
  return mode === "2-Color" || mode === "Bright Multi-Color";
}


function isMonotoneLockedMode(mode) {
  return mode === "Monotone" || mode === "Sepia Only";
}

function isLooseCapableMode(mode) {
  return mode === "Bright Multi-Color" || mode === "2-Color" || mode === "Vintage Washed";
}



// Helper: hex -> sRGB triplet
function hexToSRGB(hex) {
  if (!hex || typeof hex !== "string" || hex[0] !== "#" || hex.length !== 7) {
    return "sRGB unknown";
  }
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  return `sRGB ${r}, ${g}, ${b}`;
}

function generateDescription(data) {
  const tone = getSelectedTone();
  const descHue = tone === "technical" ? describeHueTechnical : describeHuePoetic;

  const primary = data.primaryHue ? descHue(data.primaryHue) : null;
  const secondary = data.secondaryHue ? descHue(data.secondaryHue) : null;
  const feelPhrase = data.feel ? feelAdj[data.feel] : "";

  const colorMode = data.colorMode;
  const colorLock = !!data.colorLock;
  const gradientOn = !!data.gradientMode;

  const vintageWashed = isVintageWashedMode(colorMode);
  const twoColor = isTwoColorMode(colorMode);
  const monotoneLocked = isMonotoneLockedMode(colorMode);

  /* ============================================================
     COLOR ENGINE ‚Äî BUILD COLOR BLOCK + COLOR PHRASES
     ============================================================ */

  let colorBlock = "";
  let colorSummaryForTech = "";
  let colorPhraseForPoetic = "";

  // As in your original working version: treat hues as hex strings
  const primaryTech = data.primaryHue ? data.primaryHue.toUpperCase() : null;
  const secondaryTech = data.secondaryHue ? data.secondaryHue.toUpperCase() : null;

  const effectiveLock = monotoneLocked ? true : colorLock;

  /* -----------------------------
     1) GRADIENT MODE (2-Color only)
     ----------------------------- */
  if (twoColor && gradientOn && primaryTech && secondaryTech) {
    const pSRGB = hexToSRGB(primaryTech);
    const sSRGB = hexToSRGB(secondaryTech);

    if (tone === "technical") {
      colorBlock =
        "COLOR SPECIFICATION (GRADIENT LOCKED):\n" +
        "A smooth sky-style linear gradient from " + primaryTech + " (" + pSRGB + ") " +
        "to " + secondaryTech + " (" + sSRGB + ").\n" +
        "The gradient must be clean, continuous, and visually dominant.\n" +
        "No additional hues, no white blending, no black blending, no tertiary colors.\n" +
        "No clouds, no texture, no noise.\n";

      colorSummaryForTech = "2-Color Gradient " + primaryTech + " \u2192 " + secondaryTech;
    } else {
      const pDesc = describeHuePoetic(data.primaryHue);
      const sDesc = describeHuePoetic(data.secondaryHue);

      colorBlock =
        "COLOR SPECIFICATION (GRADIENT LOCKED):\n" +
        "A smooth sky-like gradient flowing from " + pDesc + " " + primaryTech + " (" + pSRGB + ") " +
        "into " + sDesc + " " + secondaryTech + " (" + sSRGB + ").\n" +
      "The gradient must remain clean, continuous, and visually dominant" +
(data.category === "Atmosphere" ? ".\n" : ", with no clouds or texture.\n");



      colorPhraseForPoetic =
        "with a gradient from " + pDesc + " " + primaryTech + " into " + sDesc + " " + secondaryTech;
    }

  /* -----------------------------
     2) VINTAGE WASHED
     ----------------------------- */
  } else if (vintageWashed && primaryTech) {
    if (tone === "technical") {
      if (effectiveLock) {
        colorBlock =
          "COLOR SPECIFICATION (VINTAGE WASHED LOCKED):\n" +
          "Primary color: " + primaryTech + ", washed and desaturated for a vintage, muted aesthetic.\n" +
          "This washed tone must dominate the mural.\n";
        colorSummaryForTech = "Vintage Washed (Locked, " + primaryTech + ")";
      } else {
        colorBlock =
          "COLOR GUIDANCE (VINTAGE WASHED):\n" +
          "Suggested palette: " + primaryTech + ", softened and washed for a vintage, muted aesthetic.\n" +
          "Stability may interpret or expand this palette.\n";
        colorSummaryForTech = "Vintage Washed (Loose, " + primaryTech + ")";
      }
    } else {
      const pDesc = describeHuePoetic(data.primaryHue);
      if (effectiveLock) {
        colorBlock =
          "COLOR SPECIFICATION (VINTAGE WASHED LOCKED):\n" +
          "A washed, faded interpretation of " + pDesc + ", anchored to " + primaryTech + ".\n" +
          "This vintage tone must dominate the mural.\n";
        colorPhraseForPoetic =
          "washed and faded around " + pDesc + " " + primaryTech;
      } else {
        colorBlock =
          "COLOR GUIDANCE (VINTAGE WASHED):\n" +
          "A palette guided by " + pDesc + " " + primaryTech + ", softened and washed for a vintage aesthetic.\n";
        colorPhraseForPoetic =
          "with a softly washed, vintage interpretation of " + pDesc + " " + primaryTech;
      }
    }

  /* -----------------------------
     3) MONOTONE / SEPIA (always locked)
     ----------------------------- */
  } else if (monotoneLocked && primaryTech) {
    if (tone === "technical") {
      colorBlock =
        "COLOR SPECIFICATION (LOCKED):\n" +
        "Monotone palette anchored to " + primaryTech + ".\n" +
        "This exact tone must dominate the mural.\n";
      colorSummaryForTech = colorMode + " " + primaryTech;
    } else {
      const pDesc = describeHuePoetic(data.primaryHue);
      colorBlock =
        "COLOR SPECIFICATION (LOCKED):\n" +
        "A strictly monotone world built around " + pDesc + ", anchored to " + primaryTech + ".\n";
      colorPhraseForPoetic =
        "held in a strictly monotone palette around " + pDesc + " " + primaryTech;
    }

  /* -----------------------------
     4) GENERAL MODES (Loose or Locked)
     ----------------------------- */
  } else if (primaryTech) {
    if (tone === "technical") {
      if (effectiveLock) {
        let cm = "COLOR SPECIFICATION (LOCKED):\nPrimary color: " + primaryTech + ".\n";
        if (secondaryTech && twoColor) cm += "Secondary color: " + secondaryTech + ".\n";
        cm += "This palette must dominate the mural.\nNo competing hues.\n";
        colorBlock = cm;

        if (secondaryTech && twoColor) {
          colorSummaryForTech = "2-Color Locked " + primaryTech + " + " + secondaryTech;
        } else {
          colorSummaryForTech = "Locked " + primaryTech;
        }
      } else {
        let cm = "COLOR GUIDANCE:\nSuggested palette: " + primaryTech;
        if (secondaryTech && twoColor) cm += " + " + secondaryTech;
        cm += ". Stability may interpret or expand this palette.\n";
        colorBlock = cm;

        if (secondaryTech && twoColor) {
          colorSummaryForTech = "2-Color (Loose, " + primaryTech + " + " + secondaryTech + ")";
        } else {
          colorSummaryForTech = "Loose " + primaryTech;
        }
      }
    } else {
      const pDesc = describeHuePoetic(data.primaryHue);
      const sDesc = secondaryTech ? describeHuePoetic(data.secondaryHue) : null;

      if (effectiveLock) {
        if (secondaryTech && twoColor) {
          colorBlock =
            "COLOR SPECIFICATION (LOCKED):\n" +
            "A tightly controlled palette built around " + pDesc + " " + primaryTech + " " +
            "and " + sDesc + " " + secondaryTech + ".\n" +
            "These tones must dominate the mural.\n";
          colorPhraseForPoetic =
            "carried by " + pDesc + " " + primaryTech + " paired with " + sDesc + " " + secondaryTech;
        } else {
          colorBlock =
            "COLOR SPECIFICATION (LOCKED):\n" +
            "A tightly controlled palette built around " + pDesc + ", anchored to " + primaryTech + ".\n";
          colorPhraseForPoetic =
            "carried by " + pDesc + " " + primaryTech;
        }
      } else {
        if (secondaryTech && twoColor) {
          colorBlock =
            "COLOR GUIDANCE:\n" +
            "A palette guided by " + pDesc + " " + primaryTech + " and " + sDesc + " " + secondaryTech + ", " +
            "with room for expressive variation.\n";
          colorPhraseForPoetic =
            "using " + pDesc + " paired with " + sDesc;
        } else {
          colorBlock =
            "COLOR GUIDANCE:\n" +
            "A palette guided by " + pDesc + " " + primaryTech + ", with room for expressive variation.\n";
          colorPhraseForPoetic =
            "carried by " + pDesc;
        }
      }
    }
  }

  /* ============================================================
     TECHNICAL MODE ‚Äî COLOR FIRST
     ============================================================ */
  if (tone === "technical") {
    const lines = [];

    if (colorBlock) {
      lines.push(colorBlock.trim());
      lines.push("");
    }

    if (feelPhrase) lines.push("Feel: " + feelPhrase);
    if (data.category) lines.push("Category: " + data.category);
    if (data.subScene) lines.push("Sub-Scene: " + data.subScene);
    if (data.elements?.length) lines.push("Elements: " + data.elements.join(", "));
    if (data.applicationStyle) lines.push("Application: " + data.applicationStyle);

    if (data.colorMode) {
      let cm = "Color Mode: " + (colorSummaryForTech || data.colorMode);
      lines.push(cm);
    }

    if (data.fogMode && data.fogMode !== "none") lines.push("Fog: " + data.fogMode);
    if (data.substrateTexture) lines.push("Substrate Texture: " + data.substrateTexture);
    if (data.panelType) lines.push("Panel Type: " + data.panelType);

// ------------------------------------------------------------
// ATMOSPHERE-SPECIFIC TECHNICAL NOTES
// ------------------------------------------------------------
if (data.category === "Atmosphere") {
  lines.push("Atmospheric elements such as clouds, haze, aurora, and celestial bodies are permitted and may overlap gradient fields.");
  lines.push("Soft diffusion, layered luminosity, and subtle atmospheric scattering are acceptable visual behaviors.");
}


    return lines.join("\n");
  }

  /* ============================================================
     POETIC MODE ‚Äî COLOR FIRST
     ============================================================ */

  const poeticParts = [];

  if (colorBlock) {
    poeticParts.push(colorBlock.trim());
    poeticParts.push("");
  }

  const bodyParts = [];

  if (data.category) {
    if (feelPhrase && data.subScene) {
      bodyParts.push(
        "A " + feelPhrase + " " + data.category.toLowerCase() +
        " mural depicting " + data.subScene.toLowerCase()
      );
    } else if (data.subScene) {
  bodyParts.push(
    "A " + data.category + " mural depicting " + data.subScene.toLowerCase()
  );
} else if (data.category === "Atmosphere") {
  // Atmosphere-specific opening
  if (feelPhrase) {
    bodyParts.push("A " + feelPhrase + " atmospheric mural evoking an open sky");
  } else {
    bodyParts.push("An atmospheric mural evoking an open sky");
  }
} else if (feelPhrase) {
  bodyParts.push(
    "A " + feelPhrase + " " + data.category.toLowerCase() + " mural"
  );
} else {
  bodyParts.push("A " + data.category + " mural");
}

  }

  if (data.elements?.length) bodyParts.push("featuring " + data.elements.join(", "));

// ------------------------------------------------------------
// ATMOSPHERE-SPECIFIC POETIC ENHANCEMENTS
// ------------------------------------------------------------
if (data.category === "Atmosphere") {
  const e = data.elements || [];

  if (e.includes("milky way")) {
    bodyParts.push("beneath a sweeping galactic band");
  }
  if (e.includes("aurora")) {
    bodyParts.push("lit by drifting curtains of aurora");
  }
  if (e.includes("nebula haze")) {
    bodyParts.push("washed in diffuse cosmic haze");
  }
  if (e.includes("meteor streaks")) {
    bodyParts.push("cut by brief meteor trails");
  }
  if (e.includes("high clouds")) {
    bodyParts.push("layered with high, wind‚Äëshorn clouds");
  }
  if (e.includes("low clouds")) {
    bodyParts.push("grounded by low, drifting cloud bands");
  }
  if (e.includes("atmospheric glow")) {
    bodyParts.push("glowing with soft atmospheric light");
  }
  if (e.includes("dawn arc")) {
    bodyParts.push("touched by the first arc of dawn");
  }
  if (e.includes("moonrise")) {
    bodyParts.push("anchored by a rising moon");
  }
}

  if (data.applicationStyle) bodyParts.push("rendered in " + data.applicationStyle);
  if (colorPhraseForPoetic) bodyParts.push(colorPhraseForPoetic);
  if (data.fogMode && data.fogMode !== "none") bodyParts.push("softened by " + data.fogMode);
  if (data.substrateTexture) bodyParts.push("on " + data.substrateTexture);
  if (data.panelType) bodyParts.push("in a " + data.panelType + " format");

  poeticParts.push(bodyParts.join(", ") + ".");

  return poeticParts.join("\n");
}


/* ============================================================
   PART B ‚Äî MAIN APP (ALL DOM REFERENCES)
   ============================================================ */

document.addEventListener("DOMContentLoaded", () => {

populateSavedScenes();

  let proUnlocked = false;

  // Unlock logic
  document.getElementById("proUnlockBtn").addEventListener("click", () => {
    const pw = document.getElementById("proPassword").value;

    if (pw === "hwrenewalmural") {
      proUnlocked = true;
      alert("Pro mode unlocked.");
    } else {
      alert("Incorrect password.");
    }
  });

  // Disable right-click
  document.getElementById("muralImage").addEventListener("contextmenu", e => {
    if (!proUnlocked) e.preventDefault();
  });

  // Disable drag-to-desktop
  document.getElementById("muralImage").addEventListener("dragstart", e => {
    if (!proUnlocked) e.preventDefault();
  });

  // Disable pointer-based dragging (mobile + desktop)
  document.getElementById("muralImage").addEventListener("pointerdown", e => {
    if (!proUnlocked) e.preventDefault();
  });

  /* -----------------------------
     DOM ELEMENT LOOKUPS
     ----------------------------- */

  const categorySelect = document.getElementById("categorySelect");
  const subSceneSelect = document.getElementById("subSceneSelect");
  const elementsSelect = document.getElementById("elementsSelect");
  const applicationSelect = document.getElementById("applicationSelect");
  const fogModeSelect = document.getElementById("fogModeSelect");
  const substrateTextureSelect = document.getElementById("substrateTextureSelect");
  const panelTypeSelect = document.getElementById("panelTypeSelect");
  const lockStyleToggle = document.getElementById("lockStyleToggle");

  const colorMode = document.getElementById("colorMode");
  const primaryHue = document.getElementById("primaryHue");
  const secondaryHue = document.getElementById("secondaryHue");

  const primaryHueContainer = document.getElementById("primaryHueContainer");
  const secondaryHueContainer = document.getElementById("secondaryHueContainer");

  const imagePromptEl = document.getElementById("imagePrompt");
  const colorLockToggleEl = document.getElementById("colorLockToggle");
  const gradientToggleEl = document.getElementById("gradientToggle");
  const gradientWrapperEl = document.getElementById("gradientToggleWrapper");

  /* ============================================================
     GLOBAL FEEL STATE
     ============================================================ */
  let selectedFeel = null;
  let userTouchedStyle = false;

  /* ============================================================
     FEEL PRESETS (GLOBAL, ACCESSIBLE TO ALL FUNCTIONS)
     ============================================================ */
  const feelPresets = {
    soft: {
      colorMode: "Monotone",
      applicationStyle: "Ink-Wash",
      fogMode: "Light Foreground Fog",
      substrateTexture: "Rice Paper",
      panelType: "Single Panel"
    },

    crisp: {
      colorMode: "Bright Multi-Color",
      applicationStyle: "Hand-Painted Oil",
      fogMode: "None",
      substrateTexture: "Silk Ground",
      panelType: "Single Panel"
    },

    vintage: {
      colorMode: "Vintage Faded",
      applicationStyle: "Textured Medium",
      fogMode: "None",
      substrateTexture: "Decoupaged Paper",
      panelType: "Single Panel"
    },

    modern: {
      colorMode: "Bright Multi-Color",
      applicationStyle: "Gradient Wash",
      fogMode: "None",
      substrateTexture: "Mylar Film",
      panelType: "Single Panel"
    },

    quiet: {
      colorMode: "Monotone",
      applicationStyle: "Ink-Wash",
      fogMode: "Light Foreground Fog",
      substrateTexture: "Rice Paper",
      panelType: "Single Panel"
    },

    dramatic: {
      colorMode: "Bright Multi-Color",
      applicationStyle: "Metallic Accents",
      fogMode: "Heavy Foreground Fog",
      substrateTexture: "Metallic Foil",
      panelType: "Single Panel"
    },

    rough: {
      colorMode: "2-Color",
      applicationStyle: "Textured Medium",
      fogMode: "None",
      substrateTexture: "Rough",
      panelType: "Single Panel"
    },

    smooth: {
      colorMode: "Monotone",
      applicationStyle: "Gradient Wash",
      fogMode: "None",
      substrateTexture: "Smooth",
      panelType: "Single Panel"
    },

    American: {
      colorMode: "Bright Multi-Color",
      applicationStyle: "Hand-Painted Oils",
      fogMode: "None",
      substrateTexture: "Canvas",
      panelType: "Single Panel"
    },

    "East Asian": {
      colorMode: "Monotone",
      applicationStyle: "Ink-Wash",
      fogMode: "Light Foreground Fog",
      substrateTexture: "Rice Paper",
      panelType: "Scroll"
    }
  };

  /* ============================================================
     APPLY FEEL PRESET
     ============================================================ */
  function applyFeelPreset(feel) {
    const preset = feelPresets[feel];
    if (!preset) return;

    if (preset.applicationStyle) applicationSelect.value = preset.applicationStyle;
    if (preset.colorMode) colorMode.value = preset.colorMode;
    if (preset.fogMode) fogModeSelect.value = preset.fogMode;
    if (preset.substrateTexture) substrateTextureSelect.value = preset.substrateTexture;
    if (preset.panelType) panelTypeSelect.value = preset.panelType;
  }

  /* ============================================================
     FEEL BUTTON HANDLER ‚Äî CONDITIONAL PRESET LOGIC
     ============================================================ */
  document.querySelectorAll(".feel-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const feel = btn.dataset.feel;

      // UNSELECT
      if (selectedFeel === feel) {
        selectedFeel = null;
        document.querySelectorAll(".feel-btn").forEach(b => b.classList.remove("active"));
        updateOutput();
        return;
      }

      // SELECT
      const firstTimeSelectingFeel = (selectedFeel == null);

      selectedFeel = feel;
      document.querySelectorAll(".feel-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      // Only apply presets if:
      // - user has NOT touched style controls
      // - AND this is the first Feel selection
      if (!userTouchedStyle && firstTimeSelectingFeel) {
        applyFeelPreset(feel);
      }

      updateOutput();
    });
  });

  /* ============================================================
     STYLE CONTROLS ‚Äî MARK USER OVERRIDE
     ============================================================ */
  applicationSelect.addEventListener("change", () => userTouchedStyle = true);
  colorMode.addEventListener("change", () => userTouchedStyle = true);
  fogModeSelect.addEventListener("change", () => userTouchedStyle = true);
  substrateTextureSelect.addEventListener("change", () => userTouchedStyle = true);
  panelTypeSelect.addEventListener("change", () => userTouchedStyle = true);
  primaryHue.addEventListener("input", () => userTouchedStyle = true);
  secondaryHue.addEventListener("input", () => userTouchedStyle = true);

  /* ============================================================
     COLOR ENGINE ‚Äî BOTH PINWHEELS
     ============================================================ */
  let primaryWheel = null;
  let secondaryWheel = null;
  let lastMode = null;
  let secondaryLocked = false;



  // Ensure lock + gradient always update description immediately
  if (colorLockToggleEl) {
    colorLockToggleEl.addEventListener("change", () => {
      updateOutput();
    });
  }

  if (gradientToggleEl) {
    gradientToggleEl.addEventListener("change", () => {
      updateOutput();
    });
  }

  // imagePrompt auto-expand
  if (imagePromptEl) {
    imagePromptEl.addEventListener("input", function () {
      autoExpand(this);
    });
  }

  colorMode.addEventListener("change", () => {
    const mode = colorMode.value;

    // Clear mural description + prompt on mode change
    const descEl = document.getElementById("descriptionOutput");
    if (descEl) descEl.textContent = "";

    const promptBox = document.getElementById("imagePrompt");
    if (promptBox) {
      promptBox.value = "";
      autoExpand(promptBox);
    }

    // HANDLE MODE TRANSITIONS ‚Äî CLEAN VERSION
    const leavingTwoHueMode =
      !["2-Color", "Bright Multi-Color"].includes(mode);

    // Reset secondary lock whenever mode changes
    secondaryLocked = false;

    // If leaving a 2-hue mode, remove the secondary wheel completely
    if (leavingTwoHueMode) {

      // Remove wheel object
      if (secondaryWheel) secondaryWheel = null;

      // Remove wheel DOM
      const secEl = document.getElementById("secondaryHueWheel");
      if (secEl) secEl.innerHTML = "";

      // Only clear secondary hue if the new mode does NOT use it
      secondaryHue.value = "";
    }

    // DETERMINE WHICH WHEELS SHOULD BE VISIBLE
    const needsHue = ["2-Color", "Bright Multi-Color", "Monotone"].includes(mode);
    const needsTwoHues = ["2-Color", "Bright Multi-Color"].includes(mode);

    primaryHueContainer.classList.toggle("hidden", !needsHue);
    secondaryHueContainer.classList.toggle("hidden", !needsTwoHues);

    // If NOT a two-hue mode, ensure secondary wheel is fully removed
    if (!needsTwoHues) {
      const secEl = document.getElementById("secondaryHueWheel");
      if (secEl) secEl.innerHTML = "";   // wipe DOM
      secondaryWheel = null;             // wipe object
    }

// SECONDARY WHEEL INIT
if (needsTwoHues && !secondaryWheel) {
  const secEl = document.getElementById("secondaryHueWheel");
  if (secEl) secEl.innerHTML = ""; // prevent stacked wheels

  secondaryWheel = new iro.ColorPicker("#secondaryHueWheel", {
  width: Math.min(240, Math.floor(window.innerWidth * 0.45)),
  color: secondaryHue.value || "#ccddee",
  layout: [
    { component: iro.ui.Wheel },
    { component: iro.ui.Slider, options: { sliderType: "value" } },
    { component: iro.ui.Slider, options: { sliderType: "saturation" } }
  ]
});


  updateSecondarySwatch(secondaryWheel.color);

  secondaryWheel.on("color:change", c => {
    secondaryLocked = true;
    secondaryHue.value = c.hexString;
    updateSecondarySwatch(c);
    updateOutput();   // normal update
  });
}

// PRIMARY WHEEL INIT
if (needsHue && !primaryWheel) {
  const primEl = document.getElementById("primaryHueWheel");
  if (primEl) primEl.innerHTML = ""; // prevent stacked wheels

primaryWheel = new iro.ColorPicker("#primaryHueWheel", {
  width: Math.min(240, Math.floor(window.innerWidth * 0.45)),
  color: primaryHue.value || "#aabbcc",
  layout: [
    { component: iro.ui.Wheel },
    { component: iro.ui.Slider, options: { sliderType: "value" } },
    { component: iro.ui.Slider, options: { sliderType: "saturation" } }
  ]
});


  updatePrimarySwatch(primaryWheel.color);

  primaryWheel.on("color:change", c => {
    primaryHue.value = c.hexString;
    updatePrimarySwatch(c);

    secondaryLocked = false;

    // Auto-analogous only in 2-hue modes
    if (!secondaryLocked && secondaryWheel &&
        ["2-Color", "Bright Multi-Color"].includes(colorMode.value)) {

      const a = analogousColor(c.hexString);
      secondaryHue.value = a;
      secondaryWheel.color.hexString = a;
      updateSecondarySwatch(secondaryWheel.color);
    }

    updateOutput();   // normal update
  });
}

/* ‚≠ê‚≠ê‚≠ê MOBILE RESIZE GOES HERE ‚Äî AFTER INIT, BEFORE UPDATE ‚≠ê‚≠ê‚≠ê */
if (window.innerWidth < 425) {
  if (primaryWheel) primaryWheel.resize(100);
  if (secondaryWheel) secondaryWheel.resize(100);
}
/* ‚≠ê‚≠ê‚≠ê END MOBILE RESIZE ‚≠ê‚≠ê‚≠ê */

lastMode = mode;

// FALLBACK UPDATE ‚Äî description updates even if colorMode is blank
updateOutput();

  });




/* -----------------------------
   updateOutput()
   ----------------------------- */
function updateOutput() {
  const styleSource = lockedStyle || {
    applicationStyle: applicationSelect.value,
    colorMode: colorMode.value,
    fogMode: fogModeSelect.value,
    substrateTexture: substrateTextureSelect.value,
    panelType: panelTypeSelect.value
  };

  const currentColorMode = styleSource.colorMode;

  // Show/hide Gradient toggle
  if (isTwoColorMode(currentColorMode)) {
    gradientWrapperEl.classList.remove("hidden");
  } else {
    gradientWrapperEl.classList.add("hidden");
    if (gradientToggleEl) gradientToggleEl.checked = false;
  }

  // Force lock for Monotone / Sepia
  let effectiveColorLock = colorLockToggleEl ? colorLockToggleEl.checked : false;
  if (isMonotoneLockedMode(currentColorMode)) {
    effectiveColorLock = true;
    if (colorLockToggleEl) {
      colorLockToggleEl.checked = true;
      colorLockToggleEl.disabled = true;
    }
  } else {
    if (colorLockToggleEl) colorLockToggleEl.disabled = false;
  }

  const data = {
    category: categorySelect.value,
    subScene: subSceneSelect.value,
    elements: Array.from(elementsSelect.selectedOptions)
      .filter(o => !o.disabled)
      .map(o => o.value),
    applicationStyle: styleSource.applicationStyle,
    colorMode: styleSource.colorMode,
    fogMode: styleSource.fogMode,
    substrateTexture: styleSource.substrateTexture,
    panelType: styleSource.panelType,
    primaryHue: primaryHue.value,
    secondaryHue: secondaryHue.value,
    feel: selectedFeel,
    colorLock: effectiveColorLock,
    gradientMode: gradientToggleEl ? gradientToggleEl.checked : false
  };



  /* ============================================================
     ‚≠ê TWO-COLOR ENFORCEMENT (2-Color + Bright Multi-Color)
     ============================================================ */
  if (data.colorMode === "2-Color" || data.colorMode === "Bright Multi-Color") {
    if (!data.secondaryHue) {
      // If secondary hue is empty, use stored value or fallback to primary
      data.secondaryHue = secondaryHue.value || primaryHue.value;
    }
  }


  /* ============================================================
     ‚≠ê FALLBACK: If colorMode is blank, still generate description
     ============================================================ */
  if (!data.colorMode) {
    const desc = generateDescription(data, { skipColor: true });
    document.getElementById("descriptionOutput").textContent = desc;

    const promptBox = document.getElementById("imagePrompt");
    if (promptBox) {
      promptBox.value = desc;
      autoExpand(promptBox);
    }
    return;
  }



  // Secondary hue visibility
  if (
    ["2-Color","Bright Multi-Color"].includes(data.colorMode) ||
    data.category === "D√©grad√© or Ombr√© Only"
  ) {
    secondaryHueContainer.classList.remove("hidden");
  } else {
    secondaryHueContainer.classList.add("hidden");
  }

  // Tags
  const tags = [
    data.category ? data.category.toLowerCase() : null,
    data.subScene ? data.subScene.toLowerCase().replace(/ /g,"-") : null,
    ...data.elements.map(e => e.toLowerCase().replace(/ /g,"-")),
    data.applicationStyle ? data.applicationStyle.toLowerCase().replace(/ /g,"-") : null,
    data.colorMode ? data.colorMode.toLowerCase().replace(/ /g,"-") : null,
    data.fogMode ? data.fogMode.toLowerCase().replace(/ /g,"-") : null,
    data.substrateTexture ? data.substrateTexture.toLowerCase().replace(/ /g,"-") : null,
    data.panelType ? data.panelType.toLowerCase().replace(/ /g,"-") : null,
    data.primaryHue ? `hue-${data.primaryHue.replace("#","")}` : null,
    data.secondaryHue ? `hue-${data.secondaryHue.replace("#","")}` : null
  ].filter(Boolean);

  document.getElementById("tagPreview").innerHTML =
    tags.map(t => `<span class="tag">#${t}</span>`).join(" ");

  document.getElementById("jsonOutput").textContent =
    JSON.stringify(data, null, 2);

  /* ============================================================
     ‚≠ê NORMAL DESCRIPTION GENERATION
     ============================================================ */
  const description = generateDescription(data);
  document.getElementById("descriptionOutput").textContent = description;

  const promptBox = document.getElementById("imagePrompt");
  if (promptBox) {
    promptBox.value = description;
    autoExpand(promptBox);
  }
}





/* ============================================================
   INITIAL COLOR-MODE DISPATCH
   ============================================================ */
colorMode.value = "Bright Multi-Color"; // your default
primaryHue.value = "#4A90E2";
secondaryHue.value = "#2D5FA8";
colorMode.dispatchEvent(new Event("change"));

/* ============================================================
   ATTRIBUTE ENGINE SETUP (SELECT POPULATION + DEFAULT CATEGORY)
   ============================================================ */

const attributes = {
  category: [
    "D√©grad√© or Ombr√© Only",
    "Scenic",
    "Chinoiserie",
    "Abstract",
    "Botanical",
    "Graphic",
    "Atmosphere"   // ‚≠ê NEW CATEGORY
  ],
  subScene: {
    Scenic: [
      "Mountain Village Pastoral",
      "Gentle Rolling Hills",
      "River Terrace Pastoral",
      "Lakeside Settlement Scene",
      "Terraced Farmland Panorama",
      "Coastal Cliff Settlement"
    ],
    Chinoiserie: [
      "Scholars' Garden Walk",
      "Willow Pavilion Scene",
      "Lotus Pond Court",
      "Mountain Scholar Retreat",
      "Imperial Garden Promenade"
    ],
    Abstract: [
      "Fragmented Horizon Field",
      "Layered Gradient Wash",
      "Intersecting Line Composition",
      "Broken Geometry Panel",
      "Atmospheric Drift Field"
    ],
    Botanical: [
      "Cherry Orchard Bloom",
      "Wisteria Canopy Scene",
      "Tropical Palm Cluster",
      "Forest Undergrowth Study",
      "Wildflower Meadow Sweep"
    ],
    Graphic: [
      "Oversized Botanical Motif",
      "Symbolic Crest Field",
      "Architectural Arch Repeat",
      "Narrative Icon Strip",
      "Graphic Flora Repeat"
    ],

    Atmosphere: []   // ‚≠ê NO SUB-SCENES
  },
  application: [
    "digitally printed ink",
    "hand-painted oils",
    "metallic accents",
    "foil underlay",
    "ink-wash",
    "gradient wash",
    "textured medium",
    "broad tattered brush strokes",
    "tight brush strokes",
    "orthogonal strokes",
    "organic strokes"
  ],
  fogMode: [
    "none",
    "light foreground fog",
    "heavy foreground fog"
  ],
  substrateTexture: [
    "rice paper",
    "silk fibers ground",
    "mylar film shiny",
    "metallic foil reflective",
    "decoupaged paper texture",
    "canvas-backed paper",
    "commercial vinyl",
    "coated matte paper"
  ],
  panelType: [
    "3-panel repeat",
    "6-panel repeat",
    "8-panel repeat",
    "continuous run"
  ],
};

const elementsByCategory = {
  Scenic: [
    "gradient sky",
    "smooth gradient sky meeting tree line",
    "smooth gradient sky meeting rolling hills",
    "effuse, layered, & faintly undulating horizontal lines",
    "effuse, layered, & faintly undulating bumpy lines",
    "birds in the distance",
    "rolling grassy hills in distance",
    "distant village roofs",
    "misty shoreline rocks",
    "terraced fields",
    "riverbank reeds",
    "fishing boat",
    "stone footbridge",
    "broken tree",
    "rolling grassy hills in foreground",
    "winding hillside path",
    "man working field",
    "hut with smoke",
    "birds in the foreground",
    "red birds",
    "blue birds",
    "brown birds",
    "black birds",
    "birds nesting",
    "bird flock",
    "bird perched",
    "woman with dog",
    "man with dog",
    "grazing animals"
  ],
  Chinoiserie: [
    "peacock in tree",
    "landing crane",
    "lotus clusters",
    "orchid spray",
    "willow branches",
    "scholar's table",
    "pavilion lanterns",
    "rock garden forms",
    "scrollwork railing",
    "bridge with balustrade"
  ],
  Botanical: [
    "botanicals in the foreground",
    "botanicals in the distance",
    "wireframe botanicals with white & silver fills",
    "cherry tree",
    "vertical flowering vine with branches and blooms",
    "wisteria canopy",
    "cherry blossom clusters",
    "tropical palm fronds",
    "wildflower sweep",
    "fern understory",
    "orchid sprays",
    "climbing ivy",
    "broadleaf foliage",
    "seed heads and grasses"
  ],
  Abstract: [
    "effuse, layered, & faintly undulating horizontal lines",
    "effuse, layered, & faintly undulating bumpy lines",
    "wide & soft-edged horizontal bands",
    "wide & soft-edged vertical bands",
    "narrow & soft-edged horizontal bands",
    "narrow & soft-edged vertical bands",
    "large open brush streaks and drips",
    "intersecting brush strokes",
    "fragmented horizontal strokes",
    "layered gradient fields",
    "intersecting linework",
    "broken geometry shards",
    "floating shapes",
    "soft diffusion bands",
    "angled stripe clusters"
  ],
  Graphic: [
    "oversized motif",
    "symbolic crest",
    "architectural arch repeat",
    "narrative icon strip",
    "graphic flora repeat",
    "bold framing lines",
    "emblematic medallion"
  ],

  Atmosphere: [   // ‚≠ê NEW ATMOSPHERE ELEMENTS
    "stars",
    "planets",
    "milky way",
    "aurora",
    "nebula haze",
    "high clouds",
    "low clouds",
    "atmospheric glow",
    "dawn arc",
    "moonrise",
    "meteor streaks"
  ]
};

function populateSelect(id, list) {
  const sel = document.getElementById(id);
  sel.innerHTML = "";
  if (!list) return;
  list.forEach(item => {
    const o = document.createElement("option");
    o.value = item;
    o.textContent = item;
    sel.appendChild(o);
  });
}

// Populate all selects
populateSelect("categorySelect", attributes.category);
populateSelect("applicationSelect", attributes.application);
populateSelect("fogModeSelect", attributes.fogMode);
populateSelect("substrateTextureSelect", attributes.substrateTexture);
populateSelect("panelTypeSelect", attributes.panelType);

// Default category
categorySelect.value = "Scenic";
populateSelect("subSceneSelect", attributes.subScene["Scenic"]);
buildElementsSelect("Scenic");
updateOutput();



// Default hues (already set above, but we reinforce swatches)
updatePrimarySwatch({ hexString: primaryHue.value });
updateSecondarySwatch({ hexString: secondaryHue.value });

// PAGE-LOAD INITIALIZATION FOR D√âGRAD√â
if (categorySelect.value === "D√©grad√© or Ombr√© Only") {
  colorMode.value = "2-Color";

  if (colorLockToggleEl) colorLockToggleEl.checked = true;
  if (gradientToggleEl) gradientToggleEl.checked = true;

  colorMode.dispatchEvent(new Event("change"));
}

// FIRST RENDER
updateOutput();

function buildElementsSelect(cat) {
  elementsSelect.innerHTML = "";

  if (cat === "D√©grad√© or Ombr√© Only") {
    const combo = ["Abstract", "Graphic"];
    combo.forEach(c => {
      const g = document.createElement("option");
      g.textContent = `${c} Elements`;
      g.disabled = true;
      g.classList.add("group-title");
      elementsSelect.appendChild(g);

      elementsByCategory[c].forEach(el => {
        const o = document.createElement("option");
        o.value = el;
        o.textContent = el;
        elementsSelect.appendChild(o);
      });
    });
    return;
  }

  const order = [cat, ...Object.keys(elementsByCategory).filter(c => c !== cat)];
  order.forEach(c => {
    const g = document.createElement("option");
    g.textContent = `${c} Elements`;
    g.disabled = true;
    g.classList.add("group-title");
    elementsSelect.appendChild(g);

    elementsByCategory[c].forEach(el => {
      const o = document.createElement("option");
      o.value = el;
      o.textContent = el;
      elementsSelect.appendChild(o);
    });
  });
}

// ============================================================
// UNIFIED EVENT BINDING ‚Äî ALL ATTRIBUTES UPDATE DESCRIPTION
// ============================================================

// Simple selects
[
  applicationSelect,
  fogModeSelect,
  substrateTextureSelect,
  panelTypeSelect,
  subSceneSelect
].forEach(el => {
  if (el) el.addEventListener("change", updateOutput);
});

// Elements (multi-select)
if (elementsSelect) {
  elementsSelect.addEventListener("change", updateOutput);
}

// Technical / Poetic mode toggle
document.querySelectorAll("input[name='tone']").forEach(r => {
  r.addEventListener("change", updateOutput);
});

// Color lock + gradient toggles
if (colorLockToggleEl) {
  colorLockToggleEl.addEventListener("change", updateOutput);
}
if (gradientToggleEl) {
  gradientToggleEl.addEventListener("change", updateOutput);
}

// ============================================================
// CATEGORY CHANGE HANDLER (WITH ATMOSPHERE SUPPORT)
// ============================================================

categorySelect.addEventListener("change", e => {
  const c = e.target.value;

  // ‚≠ê Disable sub-scene for D√©grad√© + Atmosphere
  if (c === "D√©grad√© or Ombr√© Only" || c === "Atmosphere") {
    subSceneSelect.innerHTML = "";
    subSceneSelect.disabled = true;
  } else {
    subSceneSelect.disabled = false;
    if (attributes.subScene[c]) {
      populateSelect("subSceneSelect", attributes.subScene[c]);
    } else {
      subSceneSelect.innerHTML = "";
    }
  }

  buildElementsSelect(c);
updateOutput();


  // ============================================================
  // 2. UNIVERSAL COLOR RESET ‚Äî applies to ALL categories
  // ============================================================

  // Reset ONLY the color mode ‚Äî NOT the hues
  colorMode.value = "";

  // Remove wheels but KEEP the hue values
  primaryWheel = null;
  secondaryWheel = null;

  // Clear wheel DOM containers so no leftover wheels appear
  const primEl = document.getElementById("primaryHueWheel");
  if (primEl) primEl.innerHTML = "";

  const secEl = document.getElementById("secondaryHueWheel");
  if (secEl) secEl.innerHTML = "";

  // Hide both hue containers until a color mode is chosen
  primaryHueContainer.classList.add("hidden");
  secondaryHueContainer.classList.add("hidden");

  // Reset toggles
  if (colorLockToggleEl) colorLockToggleEl.checked = false;
  if (gradientToggleEl) gradientToggleEl.checked = false;

  // Reset lock state
  secondaryLocked = false;

  // ============================================================
  // 3. SPECIAL CASE ‚Äî D√©grad√© or Ombr√© Only
  // ============================================================
  if (c === "D√©grad√© or Ombr√© Only") {

    subSceneSelect.innerHTML = "";
    elementsSelect.value = "";
    fogModeSelect.value = "";
    panelTypeSelect.value = "";
    applicationSelect.value = "digitally printed ink";
    substrateTextureSelect.value = "coated paper";

    // Auto-set color behavior for this category
    colorMode.value = "2-Color";

    if (colorLockToggleEl) colorLockToggleEl.checked = true;
    if (gradientToggleEl) gradientToggleEl.checked = true;

    // Trigger color-mode logic (wheels, swatches, etc.)
    colorMode.dispatchEvent(new Event("change"));
  }

  // ============================================================
  // 4. FINAL UPDATE
  // ============================================================
  updateOutput();
});

/* ============================
   PART 3 ‚Äî SCENE_ENGINE
   ============================ */

let selectedSceneName = null;

document.getElementById("deleteSceneBtn").addEventListener("click", () => {
  if (!selectedSceneName) {
    alert("Select a scene first.");
    return;
  }

  deleteScene(selectedSceneName);
});


const savePanel = document.getElementById("savePanel");
const saveNameInput = document.getElementById("saveNameInput");
const saveSceneBtn = document.getElementById("saveSceneBtn");
const cancelSaveBtn = document.getElementById("cancelSaveBtn");
const confirmSaveBtn = document.getElementById("confirmSaveBtn");

function generateSceneName(data) {
  const clean = str => (str || "").toLowerCase().replace(/ /g, "");
  const base =
    `${clean(data.category)}-` +
    `${clean(data.subScene)}-` +
    `${clean(data.colorMode)}-` +
    `${clean(data.panelType)}`;

  const saved = JSON.parse(localStorage.getItem("muralScenes") || "[]");
  const num = String(saved.length + 1).padStart(3, "0");

  return `${base}-${num}`;
}

function showSavePanel(name) {
  saveNameInput.value = name;
  savePanel.classList.remove("collapsed");
  savePanel.classList.add("expanded");
  saveNameInput.focus();
}

function hideSavePanel() {
  savePanel.classList.remove("expanded");
  savePanel.classList.add("collapsed");
}

saveSceneBtn.addEventListener("click", () => {
  const data = JSON.parse(document.getElementById("jsonOutput").textContent || "{}");
  showSavePanel(generateSceneName(data));
});

//test
saveSceneBtn.addEventListener("click", () => {
  console.log("Save button clicked");
  const data = JSON.parse(document.getElementById("jsonOutput").textContent || "{}");
  showSavePanel(generateSceneName(data));
});


cancelSaveBtn.addEventListener("click", hideSavePanel);

//test
confirmSaveBtn.addEventListener("click", () => {
  const data = JSON.parse(document.getElementById("jsonOutput").textContent || "{}");
confirmSaveBtn.addEventListener("click", () => {
  console.log("Confirm Save clicked");
  const raw = document.getElementById("jsonOutput").textContent;
  console.log("jsonOutput raw:", raw);
  const data = JSON.parse(raw || "{}");

  data.feel = selectedFeel || null;

  const name = saveNameInput.value.trim() || generateSceneName(data);

  const saved = JSON.parse(localStorage.getItem("muralScenes") || "[]");
  saved.unshift({ name, data });

  console.log("Saving scenes:", saved);
  localStorage.setItem("muralScenes", JSON.stringify(saved));
  populateSavedScenes();
  hideSavePanel();
});



  // ‚≠ê Save FEEL
  data.feel = selectedFeel || null;

  const name = saveNameInput.value.trim() || generateSceneName(data);

  const saved = JSON.parse(localStorage.getItem("muralScenes") || "[]");
  saved.unshift({ name, data });

  localStorage.setItem("muralScenes", JSON.stringify(saved));
  populateSavedScenes();
  hideSavePanel();
});


function loadScene(scene) {
  categorySelect.value = scene.category;

  populateSelect("subSceneSelect", attributes.subScene[scene.category]);
  subSceneSelect.value = scene.subScene;

  buildElementsSelect(scene.category);

  Array.from(elementsSelect.options).forEach(opt => {
    opt.selected = !opt.disabled && scene.elements.includes(opt.value);
  });

  if (!lockedStyle) {
    applicationSelect.value = scene.applicationStyle;
    colorMode.value = scene.colorMode;
    fogModeSelect.value = scene.fogMode;
    substrateTextureSelect.value = scene.substrateTexture;   // ‚≠ê FIXED
    panelTypeSelect.value = scene.panelType;
  }

  // ‚≠ê Restore FEEL if you use it
  if (scene.feel) {
    selectedFeel = scene.feel;
    document.querySelectorAll(".feel-btn").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.feel === scene.feel);
    });
  } else {
    selectedFeel = null;
    document.querySelectorAll(".feel-btn").forEach(btn => btn.classList.remove("active"));
  }

  // ‚≠ê Restore hues
  primaryHue.value = scene.primaryHue || "#000000";
  secondaryHue.value = scene.secondaryHue || "#000000";

  updateOutput();
}



function populateSavedScenes() {
  const container = document.getElementById("savedScenesList");
  const saved = JSON.parse(localStorage.getItem("muralScenes") || "[]");

  saved.reverse();

  container.innerHTML = "";

  saved.forEach(item => {
    const btn = document.createElement("button");
    btn.textContent = item.name;
    btn.classList.add("scene-item");

    btn.addEventListener("click", () => {
      loadScene(item.data);

      document.querySelectorAll(".scene-item")
        .forEach(b => b.classList.remove("selected"));

      btn.classList.add("selected");

      selectedSceneName = item.name;
    });

    container.appendChild(btn);
  });
}


// ‚≠ê deleteScene MUST be outside populateSavedScenes
function deleteScene(name) {
  if (!name) return;

  const saved = JSON.parse(localStorage.getItem("muralScenes") || "[]");
  const filtered = saved.filter(item => item.name !== name);

  localStorage.setItem("muralScenes", JSON.stringify(filtered));

  selectedSceneName = null;
  populateSavedScenes();
}




document.getElementById("copyDescriptionBtn").addEventListener("click", () => {
  const text = document.getElementById("imagePrompt").value;
  if (text) navigator.clipboard.writeText(text);
});



const features = document.querySelectorAll(".feature");
let index = 0;
let round = 0;

function strobeNext() {
  if (index < features.length) {
    const el = features[index];
    el.classList.add("strobe");

    setTimeout(() => {
      el.classList.remove("strobe");
    }, 2500);

    index++;
    setTimeout(strobeNext, 2500);
  } else {
    round++;
    if (round < 3) {
      index = 0;
      strobeNext();
    }
  }
}


}); // END DOMContentLoaded



// ‚≠ê PWA‚ÄëSAFE IMAGE LOAD HANDLER ‚≠ê
const muralImage = document.getElementById("muralImage");
const imageWrapper = document.getElementById("imageWrapper");

function showWatermark() {
  imageWrapper.classList.add("has-image");
}

if (muralImage.complete) {
  // Image already loaded (cached) ‚Äî PWA case
  showWatermark();
} else {
  muralImage.addEventListener("load", showWatermark);
}





</script>










</body>
</html>
